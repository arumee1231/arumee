<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#ffffff" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>Arumee ‚Äî Premium Cold‚ÄëPressed Oils</title>
  <meta name="description" content="Arumee ‚Äî Premium cold‚Äëpressed oils. Pure, natural, and traditionally pressed coconut, groundnut, and gingelly oils." />
  <link rel="icon" type="image/png" href="arumee_assets/favicon.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;800&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --green: #1e4d32;
      --green-dark: #153d28;
      --gold: #9d7c2a;
      --gold-light: #b8941f;
      --cream: #faf8f5;
      --ink: #0a2817;
      --accent: #8b4513;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      color: var(--ink);
      background: var(--cream);
      scroll-behavior: smooth;
    }
    .container { width: min(1200px, 92vw); margin: 0 auto; }

    /* HERO */
    header.hero {
      position: relative;
      padding: 35px 0 40px;
      background: linear-gradient(135deg, rgba(30,77,50,.08), rgba(157,124,42,.06));
      overflow: hidden;
      border-bottom: 3px solid var(--gold);
    }
    header.hero::before {
      content: '';
      position: absolute;
      inset: 0;
      background: url('arumee_assets/bg_texture.jpg') center/cover no-repeat;
      opacity: 0.03;
      z-index: 0;
    }
    .brand { display: flex; align-items: center; gap: 40px; position: relative; z-index: 1; }
    .brand img { width: 160px; height: 160px; border-radius: 24px; border: 3px solid var(--gold); }
    .name { font-family: 'Playfair Display', serif; font-size: 64px; font-weight: 800; color: var(--green); }
    .tagline { font-size: 18px; color: #1b3b25; font-weight: 600; }
    .hero-cta { margin-top: 30px; display: flex; gap: 18px; flex-wrap: wrap; }
    .btn {
      padding: 16px 32px;
      border-radius: 999px;
      border: 3px solid var(--green);
      background: #fff;
      color: var(--green);
      font-weight: 700;
      cursor: pointer;
      transition: all .3s ease;
      text-decoration: none;
    }
    .btn.fill {
      background: linear-gradient(135deg, var(--green), var(--green-dark));
      color: white;
      border-color: var(--green);
    }
    .btn:hover { transform: translateY(-3px); border-color: var(--gold); box-shadow: 0 18px 40px rgba(10,110,53,.3); }

    /* CART TAB & DROPDOWN */
    .cart-tab {
      position: fixed;
      top: 20px;
      right: 20px;
      background: var(--green);
      color: white;
      padding: 12px 16px;
      border-radius: 50px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 700;
      font-size: 16px;
      transition: all 0.3s ease;
      z-index: 1000;
      box-shadow: 0 4px 12px rgba(30, 77, 50, 0.3);
    }
    
    .cart-tab:hover {
      background: var(--green-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 16px rgba(30, 77, 50, 0.4);
    }
    
    .cart-icon { font-size: 18px; }
    
    .cart-count {
      background: var(--gold);
      color: white;
      border-radius: 50%;
      min-width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 12px;
      font-weight: 800;
      animation: bounce 0.5s ease;
    }
    
    @keyframes bounce {
      0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
      40% { transform: translateY(-8px); }
      60% { transform: translateY(-4px); }
    }
    
    .cart-dropdown {
      position: fixed;
      top: 80px;
      right: 20px;
      background: white;
      border: 3px solid var(--green);
      border-radius: 16px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
      width: 350px;
      max-height: 500px;
      z-index: 9999;
      overflow: hidden;
      /* Animation defaults */
      transform: translateX(110%);
      opacity: 0;
      pointer-events: none;
      transition: transform .35s cubic-bezier(.22,.9,.24,1), opacity .35s ease;
      will-change: transform, opacity;
    }
    .cart-dropdown.open {
      transform: translateX(0);
      opacity: 1;
      pointer-events: auto;
    }
    .cart-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.25);
      backdrop-filter: blur(2px);
      z-index: 9998;
      opacity: 0;
      pointer-events: none;
      transition: opacity .3s ease;
    }
    .cart-backdrop.visible {
      opacity: 1;
      pointer-events: auto;
    }
    
    .cart-header {
      background: var(--green);
      color: white;
      padding: 16px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .cart-header h3 {
      margin: 0;
      font-size: 18px;
      font-weight: 700;
    }
    
    .cart-close {
      background: none;
      border: none;
      color: white;
      font-size: 24px;
      cursor: pointer;
      padding: 0;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
      transition: background 0.3s ease;
    }
    
    .cart-close:hover {
      background: rgba(255, 255, 255, 0.1);
    }
    
    .cart-content {
      padding: 16px 20px;
      max-height: 300px;
      overflow-y: auto;
    }
    
    .empty-cart {
      text-align: center;
      color: #666;
      font-style: italic;
      margin: 20px 0;
    }
    
    .cart-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      border-bottom: 1px solid #eee;
      gap: 12px;
    }
    
    .cart-item:last-child {
      border-bottom: none;
    }
    
    .cart-item-info {
      flex: 1;
      min-width: 0;
    }
    
    .cart-item-name {
      font-weight: 600;
      color: var(--green);
      font-size: 13px;
      line-height: 1.3;
      margin-bottom: 2px;
    }
    
    .cart-item-details {
      font-size: 11px;
      color: #666;
    }
    
    .cart-item-controls {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .cart-stepper {
      display: flex;
      align-items: center;
      gap: 6px;
      background: #f8f9fa;
      border-radius: 8px;
      padding: 4px;
    }
    
    .cart-stepper button {
      width: 24px;
      height: 24px;
      border: 1px solid var(--green);
      background: white;
      color: var(--green);
      font-size: 14px;
      font-weight: 700;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .cart-stepper button:hover {
      background: var(--green);
      color: white;
    }
    
    .cart-stepper input {
      width: 30px;
      height: 24px;
      text-align: center;
      font-size: 12px;
      font-weight: 600;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      color: var(--green);
    }
    
    .cart-stepper input:focus {
      outline: none;
      border-color: var(--gold);
    }
    
    .cart-item-price {
      font-weight: 700;
      color: var(--green);
      font-size: 13px;
      min-width: 50px;
      text-align: right;
    }
    
    .cart-delete-btn {
      width: 24px;
      height: 24px;
      background: transparent;
      color: #666;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .cart-delete-btn:hover {
      background: #f5f5f5;
      color: #dc3545;
      transform: scale(1.1);
    }
    
    .cart-footer {
      background: #f8f9fa;
      padding: 16px 20px;
      border-top: 1px solid #eee;
    }
    
    .cart-total {
      font-size: 18px;
      font-weight: 700;
      color: var(--green);
      margin-bottom: 12px;
      text-align: center;
    }
    
    .cart-footer .btn {
      width: 100%;
      padding: 12px;
      font-size: 14px;
    }

    /* SECTIONS */
    section { padding: 15px 0; opacity: 0; transform: translateY(40px); transition: all .8s ease; }
    section.visible { opacity: 1; transform: translateY(0); }

    h2.section-title {
      font-family: 'Playfair Display', serif;
      font-size: 46px;
      color: var(--green);
      text-align: center;
      margin-bottom: 6px;
      margin-top: 0;
    }
    p.lead { text-align: center; font-size: 18px; color: #1a4a2f; margin-bottom: 20px; margin-top: 0; }

    /* PRODUCTS */
    .grid { display: grid; gap: 20px; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); }
    .card {
      background: white;
      border-radius: 20px;
      border: 2px solid var(--gold);
      overflow: hidden;
      position: relative;
      transition: all .35s ease;
      box-shadow: 0 2px 8px rgba(30, 77, 50, 0.1);
    }
    .card:hover { 
      transform: translateY(-6px) scale(1.015); 
      border-color: var(--green); 
      box-shadow: 0 24px 56px rgba(30, 77, 50, 0.22);
    }
    .pic-wrap { position: relative; background: #ffffff; padding: 16px; text-align: center; min-height: 200px; display: flex; align-items: center; justify-content: center; }
    .pic-wrap img { position: relative; width: auto; height: 180px; max-width: 100%; object-fit: contain; }
    .content { padding: 14px 16px 18px; }
    .pill { display: inline-block; font-weight: 800; color: #fff; background: linear-gradient(135deg, var(--green), #0d8f45); border-radius: 999px; padding: 5px 11px; font-size: 11px; }
    .title { font-family: 'Inter', sans-serif; font-size: 18px; margin: 8px 0 6px; font-weight: 600; line-height: 1.3; min-height: 50px; display: flex; align-items: center; }
    .price { font-size: 24px; font-weight: 700; color: var(--green); margin: 0 0 6px; font-family: 'Inter', sans-serif; }
    .price span { font-size: 14px; color: #666; font-weight: 400; }
    .size-selector { margin: 0 0 10px; }
    .size-selector label { display: block; font-weight: 700; color: var(--green); margin-bottom: 4px; font-size: 11px; }
    .size-options { display: flex; gap: 4px; margin-bottom: 8px; }
    .size-option { 
      flex: 1; 
      padding: 6px 8px; 
      border: 2px solid var(--green); 
      background: white; 
      color: var(--green); 
      font-size: 11px; 
      font-weight: 700; 
      border-radius: 6px; 
      cursor: pointer; 
      transition: all .3s ease; 
      text-align: center;
    }
    .size-option.active { background: var(--green); color: white; }
    .size-option:hover { background: var(--gold); color: white; border-color: var(--gold); }
    .quantity-selector { margin: 0 0 10px; }
    .quantity-selector label { display: block; font-weight: 700; color: var(--green); margin-bottom: 4px; font-size: 11px; }
    .quantity-stepper { display: flex; align-items: center; gap: 6px; }
    .quantity-stepper button { width: 32px; height: 32px; border: 2px solid var(--green); background: white; color: var(--green); font-size: 18px; font-weight: 700; border-radius: 8px; cursor: pointer; transition: all .3s ease; display: flex; align-items: center; justify-content: center; }
    .quantity-stepper button:hover { background: var(--green); color: white; }
    .quantity-stepper button:active { transform: scale(0.95); }
    .quantity-stepper input { width: 55px; height: 32px; text-align: center; font-size: 14px; font-weight: 700; border: 2px solid var(--green); border-radius: 8px; color: var(--green); }
    .quantity-stepper input:focus { outline: none; border-color: var(--gold); }
    .add-to-order { width: 100%; margin-top: 10px; padding: 10px; background: linear-gradient(135deg, var(--green), #0d8f45); color: white; border: none; border-radius: 10px; font-weight: 700; font-size: 14px; cursor: pointer; transition: all .3s ease; }
    .add-to-order:hover { background: linear-gradient(135deg, #0d8f45, var(--green)); transform: translateY(-2px); box-shadow: 0 6px 16px rgba(10,110,53,.3); }
    .add-to-order:active { transform: translateY(0); }
    .benefits { display: flex; flex-wrap: wrap; gap: 5px; margin-top: 10px; min-height: 70px; align-content: flex-start; }
    .benefit {
      position: relative; padding: 6px 10px; border-radius: 10px; border: 2px solid var(--green);
      background: linear-gradient(135deg, #ffffff, #f8fdf9);
      font-weight: 700; color: var(--green); font-size: 11px;
      transition: all .3s ease;
    }
    .benefit:hover { border-color: var(--gold); background: linear-gradient(135deg, #ffffff, #fffdf7); transform: scale(1.05); }

    /* ORDER FORM */
    form.card { padding: 40px; max-width: 800px; margin: 0 auto; }
    form input, form select, form textarea {
      width: 100%; padding: 16px; border-radius: 14px; border: 3px solid var(--green);
      font-size: 16px; margin-top: 8px; transition: border-color 0.3s ease;
    }
    
    /* Form validation styles */
    form input:invalid:not(:focus):not(:placeholder-shown) {
      border-color: #dc3545;
      background-color: #ffeaea;
    }
    
    form input:valid:not(:focus):not(:placeholder-shown) {
      border-color: #28a745;
      background-color: #eafaf1;
    }
    
    form input:focus {
      outline: none;
      border-color: var(--gold);
      box-shadow: 0 0 0 2px rgba(157, 124, 42, 0.2);
    }

    /* FOOTER */
    footer {
      background: linear-gradient(135deg, rgba(30,77,50,.05), rgba(157,124,42,.04));
      border-top: 3px solid var(--gold);
      text-align: center;
      padding: 50px 0;
      color: var(--green-dark);
    }
    footer .tag { font-family: 'Playfair Display', serif; font-style: italic; font-size: 18px; margin-bottom: 10px; }
    footer .mini { font-size: 15px; }

    /* TOAST NOTIFICATION */
    .toast { 
      position: fixed; 
      top: -100px; 
      left: 50%; 
      transform: translateX(-50%); 
      background: rgba(10,110,53,0.85); 
      color: white; 
      padding: 16px 32px; 
      border-radius: 12px; 
      font-weight: 700; 
      font-size: 16px; 
      z-index: 1000; 
      transition: top .4s ease;
      box-shadow: 0 8px 24px rgba(0,0,0,.2);
      backdrop-filter: blur(8px);
      opacity: 0;
      visibility: hidden;
    }
    .toast.show { 
      top: 20px;
      opacity: 1;
      visibility: visible;
    }

    /* SCROLL-TOP BUTTON */
    #scrollTop {
      position: fixed; bottom: 30px; right: 30px;
      width: 48px; height: 48px;
      border-radius: 50%; border: none;
      background: var(--green); color: white;
      cursor: pointer; font-size: 20px; display: none;
    }
    #scrollTop:hover { background: var(--gold); box-shadow: 0 6px 16px rgba(0,0,0,.3); }

    /* WHATSAPP BUTTON */
    #whatsappBtn { 
      position: fixed; 
      bottom: 20px; 
      left: 20px; 
      background: transparent; 
      border-radius: 50%; 
      width: 60px; 
      height: 60px; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
      box-shadow: 0 4px 12px rgba(0,0,0,.15); 
      z-index: 999; 
      transition: all .3s ease; 
      text-decoration: none; 
    }
    #whatsappBtn img {
      width: 100%;
      height: 100%;
      border-radius: 50%;
    }
    #whatsappBtn:hover { 
      transform: scale(1.1); 
      box-shadow: 0 6px 20px rgba(0,0,0,.25); 
    }

    /* CUSTOM MODAL */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(4px);
      z-index: 9999;
      animation: fadeIn 0.3s ease;
    }
    .modal-overlay.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: white;
      border-radius: 16px;
      padding: 32px;
      max-width: 440px;
      width: 90%;
      animation: slideIn 0.3s ease;
      position: relative;
      border: 2px solid var(--green);
    }
    .modal-icon {
      width: 64px;
      height: 64px;
      background: linear-gradient(135deg, var(--green), var(--green-dark));
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      margin: 0 auto 20px;
      color: white;
      font-weight: 900;
    }
    .modal-title {
      font-family: 'Playfair Display', serif;
      font-size: 24px;
      font-weight: 700;
      color: var(--green);
      text-align: center;
      margin: 0 0 16px;
    }
    .modal-message {
      font-size: 15px;
      line-height: 1.6;
      color: #333;
      text-align: center;
      margin-bottom: 24px;
    }
    .modal-message ul {
      list-style: none;
      padding: 0;
      margin: 12px 0;
      text-align: left;
    }
    .modal-message li {
      padding: 6px 0;
      padding-left: 24px;
      position: relative;
    }
    .modal-message li:before {
      content: '‚Ä¢';
      position: absolute;
      left: 8px;
      color: var(--gold);
      font-weight: bold;
    }
    .modal-buttons {
      display: flex;
      gap: 12px;
      justify-content: center;
    }
    .modal-btn {
      padding: 12px 32px;
      border-radius: 10px;
      border: none;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Inter', sans-serif;
    }
    .modal-btn.primary {
      background: linear-gradient(135deg, var(--green), var(--green-dark));
      color: white;
    }
    .modal-btn.primary:hover {
      transform: translateY(-2px);
    }
    .modal-btn.secondary {
      background: #f0f0f0;
      color: #555;
    }
    .modal-btn.secondary:hover {
      background: #e0e0e0;
    }
    .modal-btn.danger {
      background: linear-gradient(135deg, #dc3545, #c82333);
      color: white;
    }
    .modal-btn.danger:hover {
      background: linear-gradient(135deg, #c82333, #a71e2a);
      transform: translateY(-2px);
    }
    .modal-btn.soft-primary {
      background: linear-gradient(135deg, #6c757d, #5a6268);
      color: white;
    }
    .modal-btn.soft-primary:hover {
      background: linear-gradient(135deg, #5a6268, #495057);
      transform: translateY(-2px);
    }
    .modal-icon.warning {
      background: linear-gradient(135deg, #ff9800, #f57c00);
    }
    .modal-icon.info {
      background: linear-gradient(135deg, #17a2b8, #138496);
    }

    /* IMAGE ZOOM OVERLAY */
    .zoom-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.9);
      backdrop-filter: blur(8px);
      z-index: 10000;
      animation: fadeIn 0.3s ease;
      cursor: pointer;
    }
    .zoom-overlay.show {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .zoom-container {
      position: relative;
      max-width: 90vw;
      max-height: 90vh;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    .zoom-close {
      position: absolute;
      top: -60px;
      right: 0;
      background: none;
      border: none;
      color: white;
      font-size: 40px;
      cursor: pointer;
      z-index: 10001;
      transition: all 0.2s ease;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 50%;
    }
    .zoom-close:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.1);
    }
    #zoomedImage {
      max-width: 100%;
      max-height: 80vh;
      object-fit: contain;
      border-radius: 12px;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
      animation: slideIn 0.3s ease;
    }
    .zoom-caption {
      color: white;
      font-size: 18px;
      font-weight: 600;
      margin-top: 20px;
      text-align: center;
      font-family: 'Playfair Display', serif;
    }
    .pic-wrap {
      cursor: zoom-in;
      transition: transform 0.2s ease;
    }
    .pic-wrap:hover {
      transform: scale(1.05);
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes slideIn {
      from { 
        transform: translateY(-30px);
        opacity: 0;
      }
      to { 
        transform: translateY(0);
        opacity: 1;
      }
    }

    /* MOBILE RESPONSIVE */
    @media (max-width: 768px) {
      .container { width: 90vw; }
      
      /* Cart responsive */
      .cart-tab {
        top: 15px;
        right: 15px;
        padding: 10px 14px;
        font-size: 14px;
      }
      
      .cart-dropdown {
        top: 70px;
        right: 15px;
        width: calc(100vw - 30px);
        max-width: 320px;
      }
      
      /* Cart item controls mobile */
      .cart-item {
        padding: 10px 0;
        gap: 8px;
      }
      
      .cart-item-name {
        font-size: 12px;
      }
      
      .cart-stepper button {
        width: 22px;
        height: 22px;
        font-size: 12px;
      }
      
      .cart-stepper input {
        width: 28px;
        height: 22px;
        font-size: 11px;
      }
      
      .cart-delete-btn {
        width: 22px;
        height: 22px;
        font-size: 12px;
      }
      
      /* Hero section - Reduced height for mobile to show products */
      header.hero { padding: 15px 0 20px; }
      .brand { flex-direction: column; gap: 15px; text-align: center; }
      .brand img { width: 80px; height: 80px; }
      .name { font-size: 32px; line-height: 1.1; margin: 0; }
      .tagline { font-size: 13px; margin: 5px 0 0; }
      .hero-cta { justify-content: center; gap: 12px; margin-top: 15px; }
      .btn { padding: 10px 20px; font-size: 13px; }
      
      /* Sections - Reduced padding to show products higher */
      section { padding: 10px 0 20px; }
      h2.section-title { font-size: 28px; margin-top: 0; margin-bottom: 8px; }
      p.lead { font-size: 15px; margin-bottom: 12px; }
      
      /* Product grid -> mobile carousel (horizontal scroll snap) */
      .grid {
        display: flex;
        gap: 16px;
        overflow-x: auto;
        overflow-y: visible; /* allow scaled cards to overflow vertically without being clipped */
        -webkit-overflow-scrolling: touch;
        scroll-snap-type: x mandatory;
        padding: 12px 0 24px; /* add top/bottom space so active card has room to grow */
        align-items: center; /* vertically center cards inside carousel */
      }

      /* Hide native scrollbar for a cleaner carousel look */
      .grid::-webkit-scrollbar { display: none; }
      .grid { -ms-overflow-style: none; scrollbar-width: none; }

      /* Each card becomes a horizontally scrollable 'slide' */
      .grid .card {
        flex: 0 0 85%; /* show one card (mostly) centered */
        min-width: 260px;
        scroll-snap-align: center;
        border-radius: 16px;
      }

      /* Disable hover transform on mobile to avoid layout shifts while scrolling */
      .grid .card:hover { transform: none; }

      /* Active slide styling (zoom + lift) */
      /* Prepare smoother animations */
      .grid .card {
        transition: transform .28s cubic-bezier(.2,.9,.2,1), box-shadow .28s cubic-bezier(.2,.9,.2,1);
        will-change: transform;
      }

      /* Active card: small lift only (so layout doesn't grow) */
      .grid .card.active-slide {
        transform: translateY(-6px);
        border-color: var(--green);
        box-shadow: 0 20px 48px rgba(30,77,50,0.18);
        z-index: 4;
      }

      /* Scale the product image inside the active card for a clean zoom effect */
      .pic-wrap img {
        transition: transform .36s cubic-bezier(.2,.9,.2,1), box-shadow .36s ease;
        will-change: transform;
        transform-origin: 50% 50%;
      }

      .grid .card.active-slide .pic-wrap img {
        transform: scale(1.08);
        box-shadow: none; /* remove shadow so image edges stay clean on white */
      }
      /* Ensure product artwork visually merges with card and all bottles share same visible height */
      .pic-wrap {
        height: 200px; /* fixed height so all images occupy same box */
        padding: 10px 12px;
        overflow: hidden; /* crop image edges so white canvas doesn't show */
        display: flex;
        align-items: center;
        justify-content: center;
        background: #ffffff; /* keep image area white on mobile so any translucent edges blend to white */
      }
      .pic-wrap img {
        display: block;
        width: auto;
        /* force a consistent visible height for all product artboards */
        height: 92%;
        max-width: 120%; /* allow slight horizontal overflow to hide white edges */
        object-fit: contain;
        object-position: 50% 50%;
        transform-origin: 50% 50%;
      }
      .content { padding: 16px; }
      .title { font-size: 20px; min-height: 52px; }
      .price { font-size: 26px; }
      .benefits { min-height: 70px; gap: 6px; }
      
      /* Form */
      form.card { padding: 24px; }
      form input, form select, form textarea { padding: 12px; font-size: 14px; border-radius: 10px; border-width: 2px; }
      .form-row { 
        flex-direction: column; 
        gap: 0; 
        grid-template-columns: 1fr !important;
      }
      .form-buttons { flex-direction: column; gap: 12px; }
      .form-buttons .btn { width: 100%; }
      
      /* Manual selection mobile */
      #manualSelection div[style*="grid-template-columns"] {
        grid-template-columns: 1fr !important;
        gap: 8px !important;
      }
      #manualSelection .manual-oil-select,
      #manualSelection .manual-qty {
        font-size: 14px !important;
        padding: 8px !important;
      }
      #manualSelection button[onclick*="removeManualOil"] {
        padding: 8px 12px !important;
        font-size: 14px !important;
        width: 100%;
        margin-top: 8px;
      }
      
      /* Toast & Scroll button */
      .toast { 
        padding: 14px 24px; 
        font-size: 15px; 
        border-radius: 10px;
        top: 10px;
      }
      .toast.show { 
        top: 15px;
      }
      #scrollTop { width: 44px; height: 44px; font-size: 18px; bottom: 20px; right: 20px; }
      #whatsappBtn { width: 54px; height: 54px; bottom: 20px; left: 20px; }
      
      /* Footer */
      footer { padding: 30px 0; }
      footer .tag { font-size: 16px; }
      footer .mini { font-size: 13px; }
    }

    @media (max-width: 480px) {
      /* Even more compact cart for very small screens */
      .cart-tab {
        top: 10px;
        right: 10px;
        padding: 8px 12px;
        font-size: 12px;
      }
      
      .cart-dropdown {
        top: 60px;
        right: 10px;
        width: calc(100vw - 20px);
      }
      
      /* Even smaller cart controls */
      .cart-item {
        flex-direction: column;
        align-items: stretch;
        gap: 8px;
        padding: 8px 0;
      }
      
      .cart-item-controls {
        justify-content: space-between;
      }
      
      .cart-stepper button {
        width: 20px;
        height: 20px;
        font-size: 11px;
      }
      
      .cart-stepper input {
        width: 26px;
        height: 20px;
        font-size: 10px;
      }
      
      .cart-delete-btn {
        width: 20px;
        height: 20px;
        font-size: 11px;
      }
      
      /* Even more compact hero for very small screens */
      header.hero { padding: 10px 0 15px; }
      .brand img { width: 70px; height: 70px; }
      .name { font-size: 28px; }
      .tagline { font-size: 12px; }
      h2.section-title { font-size: 24px; margin-bottom: 6px; }
      .btn { padding: 8px 16px; font-size: 12px; }
      .pic-wrap img { height: 160px; }
      .pic-wrap { min-height: 180px; }
      .title { font-size: 18px; }
      .price { font-size: 22px; }
      .quantity-stepper button { width: 36px; height: 36px; font-size: 16px; }
      .quantity-stepper input { width: 60px; height: 36px; font-size: 13px; }
      .benefit { font-size: 10px; padding: 5px 9px; }
      
      /* Form mobile improvements */
      form.card { padding: 16px; }
      form input, form select, form textarea { 
        padding: 10px; 
        font-size: 13px; 
        border-radius: 8px; 
      }
      
      /* Manual selection improvements */
      #manualSelection div[style*="grid-template-columns"] {
        display: block !important;
        margin-bottom: 12px !important;
      }
      #manualSelection div[style*="grid-template-columns"] > div {
        margin-bottom: 8px;
      }
      #manualSelection .manual-oil-select,
      #manualSelection .manual-qty {
        font-size: 13px !important;
        padding: 8px !important;
        width: 100% !important;
      }
      #manualSelection button[onclick*="removeManualOil"] {
        padding: 8px !important;
        font-size: 12px !important;
        width: 100% !important;
      }
      #manualSelection button[onclick="addManualOil()"] {
        font-size: 12px !important;
        padding: 8px 12px !important;
      }
    }
  </style>
</head>
<body>
  <header class="hero">
    <div class="container">      
      <div class="brand">
        <img src="arumee_assets/logo.png" alt="Arumee logo" />
        <div>
          <div class="name">ARUMEE<sup style="font-size:0.4em; color:var(--gold); font-weight:800;">‚Ñ¢</sup></div>
          <div class="tagline">Premium cold‚Äëpressed oils</div>
          <div class="hero-cta">
            <a class="btn fill" href="#oils">Explore Our Oils</a>
            <a class="btn" href="#oils" onclick="showOrderGuidance(event)">Order Without Payment (Call‚Äëback)</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <!-- Floating Cart Tab -->
  <div id="cartTab" class="cart-tab" onclick="toggleCart()">
    <span class="cart-icon">üõí</span>
    <span class="cart-count" id="cartCount">0</span>
  </div>

  <!-- Cart Dropdown -->
  <div id="cartDropdown" class="cart-dropdown">
    <div class="cart-header">
      <h3>Your Cart</h3>
      <button class="cart-close" onclick="toggleCart()">√ó</button>
    </div>
    <div class="cart-content" id="cartContent">
      <p class="empty-cart">Your cart is empty</p>
    </div>
    <div class="cart-footer" id="cartFooter" style="display: none;">
      <div class="cart-total" id="cartTotal">Total: ‚Çπ0</div>
      <button class="btn fill" onclick="scrollToOrder()">Proceed to Order</button>
    </div>
  </div>
  <div id="cartBackdrop" class="cart-backdrop"></div>

  <main>
    <section id="oils">
      <div class="container">
        <h2 class="section-title">Our Signature Oils</h2>
        <p class="lead">Pure, natural, and traditionally pressed.</p>
        <div class="grid">
          <article class="card">
            <div class="pic-wrap"><img src="arumee_assets/mockup_coconut.png" alt="Coconut Oil" /></div>
            <div class="content">
              <span class="pill" id="coconut-pill">Coconut ‚Ä¢ 500ml</span>
              <div class="title">Cold‚ÄëPressed Coconut Oil</div>
              <div class="price" id="coconut-price">‚Çπ225 <span>/ 500ml</span></div>
              
              <div class="size-selector">
                <label>SIZE</label>
                <div class="size-options">
                  <div class="size-option active" data-product="coconut" data-size="500ml" data-price="225">500ml</div>
                  <div class="size-option" data-product="coconut" data-size="1L" data-price="450">1L</div>
                  <div class="size-option" data-product="coconut" data-size="5L" data-price="2250">5L</div>
                </div>
              </div>

              <div class="quantity-selector">
                <label for="qty-coconut">Quantity</label>
                <div class="quantity-stepper">
                  <button type="button" onclick="decreaseQty('coconut')">‚àí</button>
                  <input type="number" id="qty-coconut" value="1" min="1" max="10" oninput="validateQty('coconut')" />
                  <button type="button" onclick="increaseQty('coconut')">+</button>
                </div>
              </div>
              <div class="benefits">
                <div class="benefit">Heart Healthy</div>
                <div class="benefit">Great for Cooking</div>
                <div class="benefit">Natural Beauty Care</div>
              </div>
              <button class="add-to-order" onclick="addToOrder('coconut', 'Cold-Pressed Coconut Oil', getCurrentPrice('coconut'))">Add to Order</button>
            </div>
          </article>
                    <article class="card">
            <div class="pic-wrap"><img src="arumee_assets/mockup_groundnut.png" alt="Groundnut Oil" /></div>
            <div class="content">
              <span class="pill" id="groundnut-pill">Groundnut ‚Ä¢ 500ml</span>
              <div class="title">Wooden Cold‚ÄëPressed Groundnut Oil</div>
              <div class="price" id="groundnut-price">‚Çπ275 <span>/ 500ml</span></div>
              
              <div class="size-selector">
                <label>SIZE</label>
                <div class="size-options">
                  <div class="size-option active" data-product="groundnut" data-size="500ml" data-price="275">500ml</div>
                  <div class="size-option" data-product="groundnut" data-size="1L" data-price="550">1L</div>
                  <div class="size-option" data-product="groundnut" data-size="5L" data-price="2750">5L</div>
                </div>
              </div>

              <div class="quantity-selector">
                <label for="qty-groundnut">Quantity</label>
                <div class="quantity-stepper">
                  <button type="button" onclick="decreaseQty('groundnut')">‚àí</button>
                  <input type="number" id="qty-groundnut" value="1" min="1" max="10" oninput="validateQty('groundnut')" />
                  <button type="button" onclick="increaseQty('groundnut')">+</button>
                </div>
              </div>
              <div class="benefits">
                <div class="benefit">Good for Heart</div>
                <div class="benefit">Rich in Protein</div>
                <div class="benefit">High Smoking Point</div>
              </div>
              <button class="add-to-order" onclick="addToOrder('groundnut', 'Wooden Cold-Pressed Groundnut Oil', getCurrentPrice('groundnut'))">Add to Order</button>
            </div>
          </article>
          <article class="card">
            <div class="pic-wrap"><img src="arumee_assets/mockup_gingelly.png" alt="Gingelly Oil" /></div>
            <div class="content">
              <span class="pill" id="gingelly-pill">Gingelly ‚Ä¢ 500ml</span>
              <div class="title">Wooden Cold‚ÄëPressed Gingelly Oil</div>
              <div class="price" id="gingelly-price">‚Çπ275 <span>/ 500ml</span></div>
              
              <div class="size-selector">
                <label>SIZE</label>
                <div class="size-options">
                  <div class="size-option active" data-product="gingelly" data-size="500ml" data-price="275">500ml</div>
                  <div class="size-option" data-product="gingelly" data-size="1L" data-price="550">1L</div>
                  <div class="size-option" data-product="gingelly" data-size="5L" data-price="2750">5L</div>
                </div>
              </div>

              <div class="quantity-selector">
                <label for="qty-gingelly">Quantity</label>
                <div class="quantity-stepper">
                  <button type="button" onclick="decreaseQty('gingelly')">‚àí</button>
                  <input type="number" id="qty-gingelly" value="1" min="1" max="10" oninput="validateQty('gingelly')" />
                  <button type="button" onclick="increaseQty('gingelly')">+</button>
                </div>
              </div>
              <div class="benefits">
                <div class="benefit">Rich in Calcium</div>
                <div class="benefit">High in Antioxidants</div>
                <div class="benefit">Great for Hair</div>
              </div>
              <button class="add-to-order" onclick="addToOrder('gingelly', 'Wooden Cold-Pressed Gingelly Oil', getCurrentPrice('gingelly'))">Add to Order</button>
            </div>
          </article>
        </div>
      </div>
    </section>

    <section id="order">
      <div class="container">
        <h2 class="section-title">Place an Order (No Online Payment)</h2>
        <p class="lead">Submit your details ‚Äî we‚Äôll call you to confirm delivery & payment.</p>
        <form class="card" onsubmit="handleSubmit(event)">
          <div class="form-row" style="display:grid; grid-template-columns: repeat(2, 1fr); gap:20px;">
            <div><label>Full Name<br><input required name="name" type="text" placeholder="Your name" minlength="2" maxlength="50" pattern="[A-Za-z\s]+" title="Please enter a valid name (letters and spaces only)"></label></div>
            <div><label>Phone / WhatsApp<br><input required name="phone" type="tel" placeholder="+91..." pattern="[\+]?[0-9\s\-]{10,15}" title="Please enter a valid phone number (10-15 digits)" maxlength="15"></label></div>
            <div style="grid-column:1/-1"><label>Address<br><input required name="address" type="text" placeholder="Door no, street, area, pincode" minlength="10" maxlength="200" title="Please enter a complete address"></label></div>
            
            <!-- Manual oil selection (shown when cart is empty) -->
            <div id="manualSelection" style="grid-column:1/-1; display:none;">
              <div style="padding:16px; background:#f9f9f9; border-radius:12px; border:2px dashed var(--green);">
                <div id="oilSelectors"></div>
                <button type="button" class="btn" style="margin-top:12px; padding:8px 16px; font-size:14px;" onclick="addManualOil()">+ Add Another Oil</button>
              </div>
            </div>
            
            <div style="grid-column:1/-1"><label>Order Summary<br><textarea id="orderDetails" name="orderDetails" rows="4" placeholder="Your selected items will appear here..." readonly style="background:#f5f5f5; resize:none; overflow:hidden; min-height:80px;"></textarea></label></div>
            <input type="hidden" id="totalAmount" name="totalAmount" value="0">
            <div style="grid-column:1/-1"><label>Additional Notes (optional)<br><textarea name="notes" rows="3" placeholder="Any special delivery instructions..."></textarea></label></div>
          </div>
          <div class="form-buttons" style="display:flex;gap:16px;justify-content:flex-end;margin-top:20px;">
            <button class="btn" type="reset" onclick="clearOrder()">Clear</button>
            <button class="btn fill" type="submit">Submit Order</button>
          </div>
        </form>
      </div>
    </section>
  </main>

  <footer>
    <div class="container">
      <div class="tag">Handcrafted with ‚ù§Ô∏è in Namakkal</div>
      <div>¬© 2025 Arumee ‚Ä¢ Mani Flour & Oil Mill</div>
      <div class="mini">FSSAI: 22425133000137 ‚Ä¢ Phone: 9751425598 / 9443342098</div>
    </div>
  </footer>

  <button id="scrollTop" onclick="window.scrollTo({top:0,behavior:'smooth'})">‚Üë</button>
  <a href="https://wa.me/6596395758" id="whatsappBtn" target="_blank" aria-label="Chat on WhatsApp" title="Chat on WhatsApp">
    <img src="arumee_assets/whatsapp_icon.png" alt="WhatsApp" />
  </a>
  <div id="toast" class="toast"></div>

  <!-- Image Zoom Overlay -->
  <div id="imageZoomOverlay" class="zoom-overlay">
    <div class="zoom-container">
      <button class="zoom-close" onclick="closeImageZoom()">&times;</button>
      <img id="zoomedImage" src="" alt="Zoomed Product Image" />
      <div class="zoom-caption"></div>
    </div>
  </div>

  <!-- Custom Modal -->
  <div id="successModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-icon">‚úì</div>
      <h3 class="modal-title">Order Submitted Successfully!</h3>
      <div class="modal-message">
        <p>We will contact you soon to confirm:</p>
        <ul>
          <li>Payment details</li>
          <li>Delivery schedule</li>
        </ul>
        <p style="margin-top: 16px;">Click OK to open WhatsApp and send your order directly to us.</p>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="closeModal()">Cancel</button>
        <button class="modal-btn primary" onclick="openWhatsApp()">OK</button>
      </div>
    </div>
  </div>

  <!-- Refresh Warning Modal -->
  <div id="refreshWarningModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-icon info">‚ÑπÔ∏è</div>
      <h3 class="modal-title">Just checking before you refresh</h3>
      <div class="modal-message">
        <p>You have <span id="cartItemCount">0</span> item(s) in your cart.</p>
        <p>Refreshing will clear your current selection and you'll need to add items again.</p>
        <p>Would you like to continue?</p>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn secondary" onclick="cancelRefresh()">Stay Here</button>
        <button class="modal-btn soft-primary" onclick="confirmRefresh()">Refresh Page</button>
      </div>
    </div>
  </div>

  <script>
    // LocalStorage functions for cart persistence
    function saveCartToStorage() {
      localStorage.setItem('arumeeCart', JSON.stringify(orderItems));
    }
    
    function loadCartFromStorage() {
      // Check if this was an intentional refresh
      if (sessionStorage.getItem('intentionalRefresh') === 'true') {
        sessionStorage.removeItem('intentionalRefresh');
        console.log('Intentional refresh detected - not loading cart');
        return;
      }
      
      const savedCart = localStorage.getItem('arumeeCart');
      if (savedCart) {
        try {
          orderItems = JSON.parse(savedCart);
          updateOrderDetails();
        } catch (e) {
          console.log('Could not load cart from storage');
          orderItems = [];
        }
      }
    }
    
    function saveFormDataToStorage() {
      const formData = {
        name: document.querySelector('input[name="name"]')?.value || '',
        phone: document.querySelector('input[name="phone"]')?.value || '',
        address: document.querySelector('input[name="address"]')?.value || ''
      };
      localStorage.setItem('arumeeFormData', JSON.stringify(formData));
    }
    
    function loadFormDataFromStorage() {
      const savedFormData = localStorage.getItem('arumeeFormData');
      if (savedFormData) {
        try {
          const formData = JSON.parse(savedFormData);
          const nameField = document.querySelector('input[name="name"]');
          const phoneField = document.querySelector('input[name="phone"]');
          const addressField = document.querySelector('input[name="address"]');
          
          if (nameField && formData.name) nameField.value = formData.name;
          if (phoneField && formData.phone) phoneField.value = formData.phone;
          if (addressField && formData.address) addressField.value = formData.address;
        } catch (e) {
          console.log('Could not load form data from storage');
        }
      }
    }
    
    let pendingWhatsAppUrl = '';

    function showSuccessModal(whatsappUrl) {
      pendingWhatsAppUrl = whatsappUrl;
      document.getElementById('successModal').classList.add('show');
    }

    function closeModal() {
      document.getElementById('successModal').classList.remove('show');
      pendingWhatsAppUrl = '';
    }

    function openWhatsApp() {
      if (pendingWhatsAppUrl) {
        window.open(pendingWhatsAppUrl, '_blank');
      }
      closeModal();
    }

    // Image Zoom Functions
    function showImageZoom(imageSrc, caption) {
      const overlay = document.getElementById('imageZoomOverlay');
      const zoomedImage = document.getElementById('zoomedImage');
      const zoomCaption = document.querySelector('.zoom-caption');
      
      zoomedImage.src = imageSrc;
      zoomCaption.textContent = caption;
      overlay.classList.add('show');
      
      // Prevent body scroll when zoom is open
      document.body.style.overflow = 'hidden';
    }
    
    function closeImageZoom() {
      const overlay = document.getElementById('imageZoomOverlay');
      overlay.classList.remove('show');
      document.body.style.overflow = '';
    }

    // Refresh Warning Modal Functions
    let pendingRefresh = false;
    
    function showRefreshWarning() {
      document.getElementById('cartItemCount').textContent = orderItems.length;
      document.getElementById('refreshWarningModal').classList.add('show');
    }
    
    function cancelRefresh() {
      document.getElementById('refreshWarningModal').classList.remove('show');
      pendingRefresh = false;
    }
    
    function confirmRefresh() {
      document.getElementById('refreshWarningModal').classList.remove('show');
      pendingRefresh = true;
      // Mark that user intentionally refreshed
      sessionStorage.setItem('intentionalRefresh', 'true');
      // Clear localStorage before refresh
      localStorage.removeItem('arumeeCart');
      localStorage.removeItem('arumeeFormData');
      location.reload();
    }

    // Show order guidance when clicking "Order Without Payment"
    function showOrderGuidance(event) {
      setTimeout(() => {
        showToast('üëÜ Choose your oils and quantities, then scroll down to submit order');
      }, 100);
    }
    
    // Quantity stepper functions
    function increaseQty(id) {
      const input = document.getElementById('qty-' + id);
      const currentVal = parseInt(input.value);
      if (currentVal < parseInt(input.max)) {
        input.value = currentVal + 1;
      }
    }
    function decreaseQty(id) {
      const input = document.getElementById('qty-' + id);
      const currentVal = parseInt(input.value);
      if (currentVal > parseInt(input.min)) {
        input.value = currentVal - 1;
      }
    }
    function validateQty(id) {
      const input = document.getElementById('qty-' + id);
      let val = parseInt(input.value);
      const min = parseInt(input.min);
      const max = parseInt(input.max);
      
      // Remove any non-numeric characters
      if (isNaN(val) || val < min) {
        input.value = min;
      } else if (val > max) {
        input.value = max;
      }
    }

    // Add to order functionality
    let orderItems = [];
    let manualSelectionCounter = 0;
    let isCartOpen = false;
    let preventCartClose = false;

    // Cart Functions
    function toggleCart() {
      const cartDropdown = document.getElementById('cartDropdown');
      const backdrop = document.getElementById('cartBackdrop');
      isCartOpen = !isCartOpen;
      if (isCartOpen) {
        // Ensure element is laid out then animate
        cartDropdown.classList.add('open');
        backdrop.classList.add('visible');
      } else {
        cartDropdown.classList.remove('open');
        backdrop.classList.remove('visible');
      }
    }

    function updateCartDisplay() {
      const cartCount = document.getElementById('cartCount');
      const cartContent = document.getElementById('cartContent');
      const cartFooter = document.getElementById('cartFooter');
      const cartTotal = document.getElementById('cartTotal');
      
      // Update cart count with animation
      const newCount = orderItems.length;
      const oldCount = parseInt(cartCount.textContent);
      
      cartCount.textContent = newCount;
      
      // Trigger bounce animation when count increases
      if (newCount > oldCount) {
        cartCount.style.animation = 'none';
        setTimeout(() => {
          cartCount.style.animation = 'bounce 0.5s ease';
        }, 10);
      }
      
      if (orderItems.length === 0) {
        cartContent.innerHTML = '<p class="empty-cart">Your cart is empty</p>';
        cartFooter.style.display = 'none';
      } else {
        let cartHTML = '';
        let grandTotal = 0;
        
        orderItems.forEach((item, index) => {
          cartHTML += `
            <div class="cart-item">
              <div class="cart-item-info">
                <div class="cart-item-name">${item.productName}</div>
                <div class="cart-item-details">‚Çπ${item.price} each</div>
              </div>
              <div class="cart-item-controls">
                <div class="cart-stepper">
                  <button onclick="updateCartItemQty(${index}, -1)">‚àí</button>
                  <input type="number" value="${item.qty}" min="1" max="10" onchange="setCartItemQty(${index}, this.value)">
                  <button onclick="updateCartItemQty(${index}, 1)">+</button>
                </div>
                <div class="cart-item-price">‚Çπ${item.total}</div>
                <button class="cart-delete-btn" onclick="removeCartItem(${index})" title="Remove item">üóëÔ∏è</button>
              </div>
            </div>
          `;
          grandTotal += item.total;
        });
        
        cartContent.innerHTML = cartHTML;
        cartTotal.textContent = `Total: ‚Çπ${grandTotal}`;
        cartFooter.style.display = 'block';
      }
    }

    function scrollToOrder() {
      toggleCart(); // Close cart
      document.getElementById('order').scrollIntoView({ behavior: 'smooth' });
    }

    // Cart item management functions
    function updateCartItemQty(index, change) {
      if (index >= 0 && index < orderItems.length) {
        const item = orderItems[index];
        const newQty = Math.max(0, Math.min(10, item.qty + change));
        
        // If quantity becomes 0, remove the item
        if (newQty === 0) {
          removeCartItem(index);
          return;
        }
        
        if (newQty !== item.qty) {
          // Prevent cart from closing when updating quantity
          preventCartClose = true;
          setTimeout(() => {
            preventCartClose = false;
          }, 500);
          
          item.qty = newQty;
          item.total = item.price * newQty;
          updateOrderDetails();
          // No toast needed - changes are visible in cart immediately
        }
      }
    }

    function setCartItemQty(index, newQty) {
      const qty = Math.max(1, Math.min(10, parseInt(newQty) || 1));
      
      if (index >= 0 && index < orderItems.length) {
        const item = orderItems[index];
        
        if (item.qty !== qty) {
          // Prevent cart from closing when updating quantity
          preventCartClose = true;
          setTimeout(() => {
            preventCartClose = false;
          }, 500);
        }
        
        item.qty = qty;
        item.total = item.price * qty;
        updateOrderDetails();
        // No toast needed - changes are visible in cart immediately
      }
    }

    function removeCartItem(index) {
      if (index >= 0 && index < orderItems.length) {
        const item = orderItems[index];
        const itemName = item.originalName || item.productName;
        
        // Prevent cart from closing when removing items
        preventCartClose = true;
        setTimeout(() => {
          preventCartClose = false;
        }, 500);
        
        orderItems.splice(index, 1);
        updateOrderDetails();
        toggleManualSelection(); // Show manual selection if cart becomes empty
        showToast(`Removed: ${itemName}`);
      }
    }
    
    const oilOptions = [
      { id: 'coconut-500ml', name: 'Cold-Pressed Coconut Oil (500ml)', price: 225 },
      { id: 'coconut-1L', name: 'Cold-Pressed Coconut Oil (1L)', price: 450 },
      { id: 'coconut-5L', name: 'Cold-Pressed Coconut Oil (5L)', price: 2250 },
      { id: 'groundnut-500ml', name: 'Wooden Cold-Pressed Groundnut Oil (500ml)', price: 275 },
      { id: 'groundnut-1L', name: 'Wooden Cold-Pressed Groundnut Oil (1L)', price: 550 },
      { id: 'groundnut-5L', name: 'Wooden Cold-Pressed Groundnut Oil (5L)', price: 2750 },
      { id: 'gingelly-500ml', name: 'Wooden Cold-Pressed Gingelly Oil (500ml)', price: 275 },
      { id: 'gingelly-1L', name: 'Wooden Cold-Pressed Gingelly Oil (1L)', price: 550 },
      { id: 'gingelly-5L', name: 'Wooden Cold-Pressed Gingelly Oil (5L)', price: 2750 }
    ];
    
    function getCurrentPrice(product) {
      const selectedSizeOption = document.querySelector(`.size-option.active[data-product="${product}"]`);
      return selectedSizeOption ? parseInt(selectedSizeOption.dataset.price) : 225;
    }
    
    function toggleManualSelection() {
      const manualDiv = document.getElementById('manualSelection');
      if (orderItems.length === 0) {
        manualDiv.style.display = 'block';
        if (document.getElementById('oilSelectors').children.length === 0) {
          addManualOil(); // Add first selector
        }
      } else {
        manualDiv.style.display = 'none';
      }
    }
    
    function addManualOil() {
      const selectorsDiv = document.getElementById('oilSelectors');
      
      // Limit to maximum 3 oils (since we only have 3 types)
      if (selectorsDiv.children.length >= 3) {
        showToast('Maximum 3 oils can be selected');
        return;
      }
      
      manualSelectionCounter++;
      const newSelector = document.createElement('div');
      newSelector.id = 'manual-' + manualSelectionCounter;
      newSelector.style.cssText = 'display:grid; grid-template-columns:2fr 1fr auto; gap:10px; margin-bottom:10px; align-items:end;';
      
      newSelector.innerHTML = `
        <div>
          <label style="font-size:13px; font-weight:600; color:var(--green);">Select Oil</label>
          <select class="manual-oil-select" style="width:100%; padding:10px; border:2px solid var(--green); border-radius:8px; font-size:14px;">
            <option value="">Choose an oil...</option>
            ${oilOptions.map(oil => `<option value="${oil.id}" data-price="${oil.price}">${oil.name} - ‚Çπ${oil.price}</option>`).join('')}
          </select>
        </div>
        <div>
          <label style="font-size:13px; font-weight:600; color:var(--green);">Quantity</label>
          <input type="number" class="manual-qty" min="1" max="10" value="1" style="width:100%; padding:10px; border:2px solid var(--green); border-radius:8px; font-size:14px;" />
        </div>
        <button type="button" onclick="removeManualOil('manual-${manualSelectionCounter}')" style="padding:10px 14px; background:var(--green); color:white; border:none; border-radius:8px; cursor:pointer; font-weight:700;">‚úï</button>
      `;
      
      selectorsDiv.appendChild(newSelector);
      
      // Add change listener to update summary
      newSelector.querySelector('.manual-oil-select').addEventListener('change', updateManualSummary);
      newSelector.querySelector('.manual-qty').addEventListener('input', updateManualSummary);
      
      // Hide "Add Another Oil" button if we've reached 3 oils
      if (selectorsDiv.children.length >= 3) {
        document.querySelector('#manualSelection button[onclick="addManualOil()"]').style.display = 'none';
      }
    }
    
    function removeManualOil(id) {
      const elem = document.getElementById(id);
      if (elem) elem.remove();
      updateManualSummary();
      
      // Show "Add Another Oil" button again if we're below 3 oils
      const selectorsDiv = document.getElementById('oilSelectors');
      if (selectorsDiv.children.length < 3) {
        document.querySelector('#manualSelection button[onclick="addManualOil()"]').style.display = 'inline-block';
      }
    }
    
    function updateManualSummary() {
      const selectors = document.querySelectorAll('#oilSelectors > div');
      let summary = '';
      let total = 0;
      let count = 0;
      
      selectors.forEach((selector, index) => {
        const select = selector.querySelector('.manual-oil-select');
        const qtyInput = selector.querySelector('.manual-qty');
        
        if (select && select.value) {
          const selectedOption = select.options[select.selectedIndex];
          const oilName = selectedOption.text.split(' - ')[0];
          const price = parseInt(selectedOption.dataset.price);
          const qty = parseInt(qtyInput.value) || 1;
          const itemTotal = price * qty;
          
          count++;
          summary += `${count}. ${oilName} = ‚Çπ${price} √ó ${qty} = ‚Çπ${itemTotal}\n`;
          total += itemTotal;
        }
      });
      
      if (summary) {
        summary += `\nTotal Amount: ‚Çπ${total}\n\n* Delivery charges extra (to be discussed during payment confirmation)`;
      }
      
      const orderDetailsTextarea = document.getElementById('orderDetails');
      const totalAmountField = document.getElementById('totalAmount');
      
      orderDetailsTextarea.value = summary;
      totalAmountField.value = total.toString();
      
      // Auto-expand textarea to fit content
      orderDetailsTextarea.style.height = 'auto';
      orderDetailsTextarea.style.height = Math.max(80, orderDetailsTextarea.scrollHeight) + 'px';
    }
    
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }
    
    function addToOrder(id, productName, price) {
      // Get selected size info
      const selectedSizeOption = document.querySelector(`.size-option.active[data-product="${id}"]`);
      const selectedSize = selectedSizeOption ? selectedSizeOption.dataset.size : '500ml';
      const selectedPrice = selectedSizeOption ? parseInt(selectedSizeOption.dataset.price) : price;
      
      const qty = parseInt(document.getElementById('qty-' + id).value);
      const total = selectedPrice * qty;
      
      // Create unique item key with size
      const itemKey = `${id}-${selectedSize}`;
      const fullProductName = `${productName} (${selectedSize})`;
      
      // Check if item already exists, update quantity
      const existingIndex = orderItems.findIndex(item => item.itemKey === itemKey);
      if (existingIndex > -1) {
        orderItems[existingIndex].qty = qty;
        orderItems[existingIndex].total = total;
        showToast(`Updated: ${fullProductName} √ó ${qty}`);
      } else {
        orderItems.push({ 
          id, 
          itemKey, 
          productName: fullProductName, 
          originalName: productName,
          size: selectedSize,
          price: selectedPrice, 
          qty, 
          total 
        });
        showToast(`Added to cart: ${fullProductName} √ó ${qty}`);
      }
      
      // Remember if cart was open before adding item
      const wasCartOpen = isCartOpen;
      
      // Prevent cart from closing for a short time when adding items
      preventCartClose = true;
      setTimeout(() => {
        preventCartClose = false;
      }, 500);
      
      updateOrderDetails();
      toggleManualSelection(); // Hide manual selection when items added
      
      // Keep cart open if it was open before adding item
      if (wasCartOpen && !isCartOpen) {
        toggleCart();
      }
    }
    
    function updateOrderDetails() {
      const orderDetailsTextarea = document.getElementById('orderDetails');
      const totalAmountField = document.getElementById('totalAmount');
      
      // Update cart display
      updateCartDisplay();
      
      if (orderItems.length === 0) {
        orderDetailsTextarea.value = '';
        orderDetailsTextarea.style.height = '80px';
        totalAmountField.value = '0';
        // Save empty cart to localStorage
        saveCartToStorage();
        return;
      }
      
      let orderText = '';
      let grandTotal = 0;
      
      orderItems.forEach((item, index) => {
        orderText += `${index + 1}. ${item.productName} = ‚Çπ${item.price} √ó ${item.qty} = ‚Çπ${item.total}\n`;
        grandTotal += item.total;
      });
      
      orderText += `\nTotal Amount: ‚Çπ${grandTotal}\n\n* Delivery charges extra (to be discussed during payment confirmation)`;
      orderDetailsTextarea.value = orderText;
      
      // Set the hidden total amount field
      totalAmountField.value = grandTotal.toString();
      
      // Auto-expand textarea to fit content
      orderDetailsTextarea.style.height = 'auto';
      orderDetailsTextarea.style.height = Math.max(80, orderDetailsTextarea.scrollHeight) + 'px';
      
      // Save cart to localStorage whenever it's updated
      saveCartToStorage();
    }
    
    function clearOrder() {
      orderItems = [];
      updateOrderDetails();
      
      // Reset all quantity inputs to 1
      document.getElementById('qty-coconut').value = 1;
      document.getElementById('qty-groundnut').value = 1;
      document.getElementById('qty-gingelly').value = 1;
      
      // Clear manual selections
      document.getElementById('oilSelectors').innerHTML = '';
      manualSelectionCounter = 0;
      
      // Show manual selection since cart is empty
      toggleManualSelection();
      
      showToast('Order cleared');
    }

    // Form submission
    function handleSubmit(e) {
      e.preventDefault();
      
      // Get form data for validation
      const form = e.target;
      const name = form.name.value.trim();
      const phone = form.phone.value.trim();
      const address = form.address.value.trim();
      
      // Validate name
      if (!name || name.length < 2) {
        alert('Please enter a valid name (at least 2 characters).');
        form.name.focus();
        return;
      }
      
      if (!/^[A-Za-z\s]+$/.test(name)) {
        alert('Name should contain only letters and spaces.');
        form.name.focus();
        return;
      }
      
      // Validate phone
      if (!phone) {
        alert('Please enter your phone number.');
        form.phone.focus();
        return;
      }
      
      // Remove all non-digits for phone validation
      const phoneDigits = phone.replace(/\D/g, '');
      if (phoneDigits.length < 10 || phoneDigits.length > 15) {
        alert('Please enter a valid phone number (10-15 digits).');
        form.phone.focus();
        return;
      }
      
      // Validate address
      if (!address || address.length < 10) {
        alert('Please enter a complete address (at least 10 characters).');
        form.address.focus();
        return;
      }
      
      // Check if either orderItems has items OR manual selection has data
      const hasCartItems = orderItems.length > 0;
      const manualSelectors = document.querySelectorAll('.manual-oil-select');
      let hasManualSelection = false;
      
      manualSelectors.forEach(select => {
        if (select.value) {
          hasManualSelection = true;
        }
      });
      
      if (!hasCartItems && !hasManualSelection) {
        alert('Please select at least one oil and quantity before placing your order.');
        return;
      }
      
      // If using manual selection, update the order details from manual inputs
      if (!hasCartItems && hasManualSelection) {
        updateManualSummary();
      }
      
      const GOOGLE_FORM_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSflC-Ev08-1K4ULCfcscEw6WsCDV-tm99cGCAIt_V0-FC7lEg/formResponse';
      
      const formData = new FormData(e.target);
      const googleFormData = new FormData();
      
      // Map form fields to Google Form entry IDs
      googleFormData.append('entry.1725501823', formData.get('name'));        // Full Name
      googleFormData.append('entry.1067964574', formData.get('phone'));       // Phone / WhatsApp
      googleFormData.append('entry.815750809', formData.get('address'));      // Address
      googleFormData.append('entry.1998696792', formData.get('orderDetails')); // Order Details
      googleFormData.append('entry.185274423', formData.get('notes') || 'None'); // Additional Notes
      googleFormData.append('entry.1620525141', formData.get('totalAmount') || '0'); // Total Amount (Replace 123456789 with actual entry ID from your Google Form)
      
      // Submit to Google Form
      fetch(GOOGLE_FORM_URL, {
        method: 'POST',
        body: googleFormData,
        mode: 'no-cors'
      }).then(() => {
        // Success - show confirmation and open WhatsApp
        const name = formData.get('name');
        const phone = formData.get('phone');
        const address = formData.get('address');
        const orderDetails = formData.get('orderDetails');
        const notes = formData.get('notes') || 'None';
        
        // WhatsApp message
        const whatsappNumber = '6596395758'; // Replace with your actual WhatsApp number (include country code, no + or spaces)
        const whatsappMessage = encodeURIComponent(
          `*New Order from ${name}*\n\n` +
          `üìû Phone: ${phone}\n` +
          `üìç Address: ${address}\n\n` +
          `*Order Details:*\n${orderDetails}\n\n` +
          `*Additional Notes:*\n${notes}\n\n` +
          `Please confirm payment and delivery details.`
        );
        
        const whatsappUrl = `https://wa.me/${whatsappNumber}?text=${whatsappMessage}`;
        
        // Show custom modal
        showSuccessModal(whatsappUrl);
        
        // Clear form and scroll to top
        setTimeout(() => {
          e.target.reset();
          clearOrder();
          // Clear saved form data from localStorage
          localStorage.removeItem('arumeeFormData');
          window.scrollTo({top: 0, behavior: 'smooth'});
        }, 1000);
        
      }).catch((error) => {
        // Error - don't clear anything
        console.error('Submission error:', error);
        alert('There was an error submitting your order. Please try again or contact us directly.');
      });
    }
    
    // Scroll to top on page load/refresh - prevent browser scroll restoration
    if ('scrollRestoration' in history) {
      history.scrollRestoration = 'manual';
    }
    window.addEventListener('beforeunload', () => {
      window.scrollTo(0, 0);
    });
    window.addEventListener('load', () => {
      window.scrollTo(0, 0);
    });
    // Also on DOMContentLoaded for faster trigger
    document.addEventListener('DOMContentLoaded', () => {
      window.scrollTo(0, 0);
      toggleManualSelection(); // Initialize manual selection visibility on page load
      
      // Cart items will be loaded from localStorage
      updateOrderDetails();
      
      // Add form validation listeners
      const nameInput = document.querySelector('input[name="name"]');
      const phoneInput = document.querySelector('input[name="phone"]');
      const addressInput = document.querySelector('input[name="address"]');
      
      // Click outside cart to close
      document.addEventListener('click', function(e) {
        if (preventCartClose) return;
        
        const cartTab = document.getElementById('cartTab');
        const cartDropdown = document.getElementById('cartDropdown');
        
        if (isCartOpen && !cartTab.contains(e.target) && !cartDropdown.contains(e.target)) {
          toggleCart();
        }
      });
      
      // Real-time phone number formatting
      phoneInput.addEventListener('input', function(e) {
        // Allow only numbers, +, spaces, and hyphens
        let value = e.target.value.replace(/[^\d\+\s\-]/g, '');
        e.target.value = value;
      });
      
      // Real-time name validation
      nameInput.addEventListener('input', function(e) {
        // Allow only letters and spaces
        let value = e.target.value.replace(/[^A-Za-z\s]/g, '');
        e.target.value = value;
      });
      
      // Add size option click handlers
      document.querySelectorAll('.size-option').forEach(option => {
        option.addEventListener('click', function() {
          const product = this.dataset.product;
          const size = this.dataset.size;
          const price = this.dataset.price;
          
          // Remove active class from all options for this product
          document.querySelectorAll(`.size-option[data-product="${product}"]`).forEach(opt => {
            opt.classList.remove('active');
          });
          
          // Add active class to clicked option
          this.classList.add('active');
          
          // Update price display
          const priceElement = document.getElementById(`${product}-price`);
          if (priceElement) {
            priceElement.innerHTML = `‚Çπ${price} <span>/ ${size}</span>`;
          }
          
          // Update pill display
          const pillElement = document.getElementById(`${product}-pill`);
          if (pillElement) {
            const productType = product.charAt(0).toUpperCase() + product.slice(1);
            pillElement.textContent = `${productType} ‚Ä¢ ${size}`;
          }
        });
      });
    });
    
    // Fade in on scroll
    const sections = document.querySelectorAll('section');
    const observer = new IntersectionObserver(entries => {
      entries.forEach(e => { if (e.isIntersecting) e.target.classList.add('visible'); });
    }, {threshold: 0.2});
    sections.forEach(sec => observer.observe(sec));

    // Scroll-top visibility
    const topBtn = document.getElementById('scrollTop');
    window.addEventListener('scroll', () => {
      topBtn.style.display = window.scrollY > 500 ? 'block' : 'none';
    });
    
    // Load saved data when page loads
    window.addEventListener('load', () => {
      loadCartFromStorage();
      loadFormDataFromStorage();
    });
    
    // Save form data as user types
    document.addEventListener('DOMContentLoaded', () => {
      const formInputs = document.querySelectorAll('input[name="name"], input[name="phone"], input[name="address"]');
      formInputs.forEach(input => {
        input.addEventListener('input', saveFormDataToStorage);
      });
      
      // Helper: detect background color by sampling image corners and remove pixels similar to that color
      // NOTE: This requires the image to be same-origin or served with CORS headers; otherwise canvas will be tainted.
      // Improved background removal: higher default threshold + soft feathering
      // Attempts to remove a uniform background color (estimated from image corners)
      // and applies a gentle alpha ramp to avoid hard halos.
      function removeWhiteBackground(img, threshold = 70, feather = 20) {
        return new Promise((resolve) => {
          try {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            canvas.width = img.naturalWidth || img.width;
            canvas.height = img.naturalHeight || img.height;
            ctx.drawImage(img, 0, 0, canvas.width, canvas.height);

            // helper: average color in a small rect
            function avgColor(x, y, w, h) {
              try {
                const d = ctx.getImageData(x, y, w, h).data;
                let r = 0, g = 0, b = 0, n = 0;
                for (let i = 0; i < d.length; i += 4) {
                  r += d[i]; g += d[i + 1]; b += d[i + 2]; n++;
                }
                return { r: Math.round(r / n), g: Math.round(g / n), b: Math.round(b / n) };
              } catch (e) { return null; }
            }

            // Sample small areas in the four corners to estimate background color
            const sample = Math.max(6, Math.floor(Math.min(canvas.width, canvas.height) * 0.03));
            const corners = [];
            corners.push(avgColor(0, 0, sample, sample));
            corners.push(avgColor(canvas.width - sample, 0, sample, sample));
            corners.push(avgColor(0, canvas.height - sample, sample, sample));
            corners.push(avgColor(canvas.width - sample, canvas.height - sample, sample, sample));

            // compute average of non-null corners
            let br = 0, bg = 0, bb = 0, count = 0;
            corners.forEach(c => { if (c) { br += c.r; bg += c.g; bb += c.b; count++; } });
            if (count === 0) { resolve(null); return; }
            const bgColor = { r: Math.round(br / count), g: Math.round(bg / count), b: Math.round(bb / count) };

            try {
              const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
              const data = imageData.data;
              const inner = Math.max(0, threshold);
              const outer = inner + Math.max(0, feather);

              for (let i = 0; i < data.length; i += 4) {
                const r = data[i], g = data[i + 1], b = data[i + 2];
                const dr = r - bgColor.r, dg = g - bgColor.g, db = b - bgColor.b;
                const distSq = dr * dr + dg * dg + db * db;
                const dist = Math.sqrt(distSq);

                if (dist <= inner) {
                  // Fully background ‚Äî make transparent
                  data[i + 3] = 0;
                } else if (dist <= outer) {
                  // In the feather zone ‚Äî set partial alpha to soften edges
                  const t = (dist - inner) / (outer - inner); // 0..1
                  // newAlpha scales from 0 (at inner) to 255 (at outer)
                  const newAlpha = Math.round(255 * t);
                  // Use the smaller of existing alpha and newAlpha to avoid increasing alpha
                  data[i + 3] = Math.min(data[i + 3], newAlpha);
                }
                // else: leave opaque pixels alone
              }

              ctx.putImageData(imageData, 0, 0);

              // Flatten transparency onto a white background so edges look white (no shading)
              try {
                const out = document.createElement('canvas');
                out.width = canvas.width;
                out.height = canvas.height;
                const outCtx = out.getContext('2d');
                // fill white
                outCtx.fillStyle = '#ffffff';
                outCtx.fillRect(0, 0, out.width, out.height);
                // draw processed image on top
                outCtx.drawImage(canvas, 0, 0);
                const newSrc = out.toDataURL();
                console.log('removeWhiteBackground: processed', img.src, 'bgColor=', bgColor, 'threshold=', threshold, 'feather=', feather);
                resolve(newSrc);
              } catch (err2) {
                // if anything goes wrong, fall back to original canvas data
                try { const newSrc = canvas.toDataURL(); resolve(newSrc); } catch (e) { resolve(null); }
              }
            } catch (err) {
              console.warn('Could not process image (CORS?):', err);
              resolve(null);
            }
          } catch (e) {
            console.warn('Background removal failed:', e);
            resolve(null);
          }
        });
      }

      // Add image zoom functionality and attempt background removal for product images
      const productImages = document.querySelectorAll('.pic-wrap img');
      productImages.forEach(img => {
        // Ensure we process after the image has loaded
        function processAndWire() {
          removeWhiteBackground(img).then(newSrc => {
            if (newSrc) {
              img.src = newSrc; // replace with processed image (transparent background)
            }
            // wire zoom behavior
            img.parentElement.addEventListener('click', (e) => {
              e.preventDefault();
              const imageSrc = img.src;
              const caption = img.alt || 'Product Image';
              showImageZoom(imageSrc, caption);
            });
          });
        }

        if (img.complete && img.naturalWidth) {
          processAndWire();
        } else {
          img.addEventListener('load', processAndWire);
        }
      });
      
      // Close zoom overlay when clicking outside image
      document.getElementById('imageZoomOverlay').addEventListener('click', (e) => {
        if (e.target.id === 'imageZoomOverlay') {
          closeImageZoom();
        }
      });
      
      // Close zoom with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeImageZoom();
        }
      });
    });
    
    // Intercept refresh attempts if cart has items
    document.addEventListener('keydown', (e) => {
      // Check for F5 or Ctrl+R (refresh shortcuts)
      if ((e.key === 'F5') || (e.ctrlKey && e.key === 'r') || (e.ctrlKey && e.key === 'R')) {
        if (orderItems.length > 0 && !pendingRefresh) {
          e.preventDefault();
          e.stopPropagation();
          e.stopImmediatePropagation();
          showRefreshWarning();
          return false;
        }
      }
    }, true);
    
    // Handle browser refresh button and other navigation
    window.addEventListener('beforeunload', (e) => {
      console.log('beforeunload triggered, orderItems.length:', orderItems.length, 'pendingRefresh:', pendingRefresh);
      if (orderItems.length > 0 && !pendingRefresh) {
        // Mark that user is leaving/refreshing with items
        sessionStorage.setItem('intentionalRefresh', 'true');
        // Set a custom message (though browsers may override it)
        const message = 'Your cart items will be lost.';
        e.returnValue = message;
        return message;
      }
    });

    /* Carousel active-slide detection: find centered card and toggle class */
    (function setupCarouselActiveSlide() {
      const carousel = document.querySelector('.grid');
      if (!carousel) return;

      const cards = Array.from(carousel.querySelectorAll('.card'));
      if (!cards.length) return;

      // Throttle utility to avoid too many calculations while scrolling
      function throttle(fn, wait) {
        let last = 0;
        let timeout = null;
        return function(...args) {
          const now = Date.now();
          const remaining = wait - (now - last);
          if (remaining <= 0) {
            if (timeout) { clearTimeout(timeout); timeout = null; }
            last = now;
            fn.apply(this, args);
          } else if (!timeout) {
            timeout = setTimeout(() => {
              last = Date.now();
              timeout = null;
              fn.apply(this, args);
            }, remaining);
          }
        };
      }

      function updateActiveSlide() {
        const carouselRect = carousel.getBoundingClientRect();
        const carouselCenter = carouselRect.left + carouselRect.width / 2;

        let closest = null;
        let minDist = Infinity;

        cards.forEach(card => {
          const rect = card.getBoundingClientRect();
          const cardCenter = rect.left + rect.width / 2;
          const dist = Math.abs(carouselCenter - cardCenter);
          if (dist < minDist) {
            minDist = dist;
            closest = card;
          }
        });

        cards.forEach(c => c.classList.toggle('active-slide', c === closest));
      }

      // Run once to initialise
      updateActiveSlide();

      // Listen to scroll and resize events
      const throttled = throttle(updateActiveSlide, 80);
      carousel.addEventListener('scroll', throttled, { passive: true });
      window.addEventListener('resize', throttled);

      // Also update when dynamic content changes (images load)
      cards.forEach(imgCard => {
        const img = imgCard.querySelector('img');
        if (img && !img.complete) img.addEventListener('load', throttled);
      });
    })();
  </script>

<script>
// --- Mobile carousel active-slide centering fix ---
document.addEventListener("DOMContentLoaded", function () {
  const carousel = document.querySelector("#oils .grid");
  if (!carousel) return;

  // Run only on mobile viewports (horizontal scroll)
  if (window.innerWidth <= 768) {
    const cards = Array.from(carousel.querySelectorAll(".card"));
    if (!cards.length) return;

    
    // Robust centering of first card inside a scroll-snap container
    const firstCard = cards[0];
    const prevSnap = carousel.style.scrollSnapType;
    // Temporarily disable snap so we can position precisely
    carousel.style.scrollSnapType = 'none';
    carousel.scrollLeft = 0; // reset
    // Position so first card center aligns to container center
    const centerIt = () => {
      try {
        // Use native snap-aware centering after restoring snap
        carousel.style.scrollSnapType = prevSnap || 'x mandatory';
        // Ensure it's exactly centered in the snap container
        firstCard.scrollIntoView({ behavior: 'auto', inline: 'center', block: 'nearest' });
      } catch(e) {
        // Fallback: math positioning
        const targetLeft = firstCard.offsetLeft - (carousel.clientWidth - firstCard.clientWidth) / 2;
        carousel.scrollLeft = Math.max(0, targetLeft);
      }
      // Make it active immediately
      cards.forEach((c, i) => c.classList.toggle("active-slide", i === 0));
      updateActiveSlide();
    };
    // Wait a tick for layout (images/fonts) then center
    requestAnimationFrame(() => requestAnimationFrame(centerIt));


    function throttle(fn, wait) {
      let ticking = false, lastArgs = null;
      return function (...args) {
        lastArgs = args;
        if (!ticking) {
          ticking = true;
          requestAnimationFrame(() => {
            fn.apply(this, lastArgs);
            ticking = false;
          });
        }
      };
    }

    function updateActiveSlide() {
      const center = carousel.scrollLeft + carousel.clientWidth / 2;
      let bestIdx = 0;
      let bestDist = Infinity;

      cards.forEach((card, idx) => {
        const cardCenter = card.offsetLeft + card.clientWidth / 2;
        const dist = Math.abs(cardCenter - center);
        if (dist < bestDist) { bestDist = dist; bestIdx = idx; }
      });

      cards.forEach((card, idx) => {
        card.classList.toggle("active-slide", idx === bestIdx);
      });
    }

    const throttledUpdate = throttle(updateActiveSlide, 80);
    carousel.addEventListener("scroll", throttledUpdate, { passive: true });
    window.addEventListener("resize", throttledUpdate);
    window.addEventListener("orientationchange", throttledUpdate);
    cards.forEach((c) => {
      const img = c.querySelector("img");
      if (img && !img.complete) img.addEventListener("load", throttledUpdate);
    });

    // Initial activation after layout
    updateActiveSlide();
  }
});
</script>

<script>
// --- Cart animation helpers ---
document.addEventListener('DOMContentLoaded', function(){
  const cartDropdown = document.getElementById('cartDropdown');
  const backdrop = document.getElementById('cartBackdrop');
  // Ensure it's displayed for animation system; opacity/transform handle visibility
  cartDropdown.style.display = 'block';

  // Click outside closes (unless we're in the middle of quantity edits)
  backdrop.addEventListener('click', function(){
    if (preventCartClose) return;
    if (isCartOpen) toggleCart();
  });

  // ESC to close
  document.addEventListener('keydown', function(e){
    if (e.key === 'Escape' && isCartOpen && !preventCartClose) {
      toggleCart();
    }
  });
});
</script>
</body>
</html>
